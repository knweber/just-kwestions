<h2> <%= @question.title %> </h2>
<p><%= @question.text %></p>

# of upvotes: <%= @question.votes.where(upvote: 'true').count %>
<p>
  # of downvotes: <%= @question.votes.where(upvote: 'false').count %>
</p>


<% if session[:user_id] != nil %>
<form id='question-upvotes' method="post" action='/votes'>
  <input type='hidden' name='voteable_type' value='question' />
  <input type='hidden' name='voteable_id' value=<%= @question.id %> />
  <input type='hidden' name='upvote' value='true' />
  <input type='hidden' name='question_page' value=<%= @question.id %> />
  <input type="submit" name="upvote-question" value="Upvote question" ></button>
</form>

<form id='question-downvotes' method="post" action='/votes'>
  <input type='hidden' name='voteable_type' value='question' />
  <input type='hidden' name='voteable_id' value=<%= @question.id %> />
  <input type='hidden' name='upvote' value='false' />
  <input type='hidden' name='question_page' value=<%= @question.id %> />
  <input type="submit" name="downvote-question" value="Downvote question" ></button>
</form>
<% end %>

<p>
  Question Author: <%= @question.user.username %>
</p>

<div id="question-comment-container">
  Question Comments:
  <% @question_comments.each do |comment|  %>
    <%= erb :'/comments/_question_comment', layout: false, locals: { comment: comment } %>
  <% end %>
</div>

<% if session[:user_id] %>
  <div id="new-question-comment-container">
    <a href="/comments/new?commentable_type=question&commentable_id=<%= @question.id %>">Post a comment</a>
    <div id="question-comment-errors"></div>
    <div id="question-comment-form-container" hidden="true">
      <%= erb :"/comments/_form", layout: false, locals: { action: "comments", commentable_type: "question", commentable_id: @question.id } %>
    </div>
  </div>
<% end %>

<% if session[:user_id] %>
  <div id="new-answer-container">
    <h3><a href="/questions/<%= @question.id %>/answers/new">Add an Answer</a></h3>
    <div id="answer-errors"></div>
    <div id="answer-form-container" hidden="true">
      <%= erb :"/answers/_form", layout: false %>
    </div>
  </div>
<% end %>

Answers:
<% @answers.each do |answer| %>
  <% if @question.best_answer == answer %>
    <h1>I'm the best! :+1:</h1>
  <% end %>
  <p>
    <%= answer.text %>
  </p>
  # of upvotes: <%= answer.votes.where(upvote: 'true').count %>
  <p>
    # of downvotes: <%= answer.votes.where(upvote: 'false').count %>
  </p>

  <% if session[:user_id] != nil %>
    <form id='answer-upvotes' method="post" action='/votes'>
      <input type='hidden' name='voteable_type' value='answer' />
      <input type='hidden' name='voteable_id' value=<%= answer.id %> />
      <input type='hidden' name='upvote' value='true' />
      <input type='hidden' name='question_page' value=<%= @question.id %> />
      <input type="submit" name="upvote-answer" value="Upvote answer" ></button>
    </form>

    <form id='answer-downvotes' method="post" action='/votes'>
      <input type='hidden' name='voteable_type' value='answer' />
      <input type='hidden' name='voteable_id' value=<%= answer.id %> />
      <input type='hidden' name='upvote' value='false' />
      <input type='hidden' name='question_page' value=<%= @question.id %> />
      <input type="submit" name="downvote-answer" value="Downvote answer" ></button>
    </form>
  <% end %>
  <% if session[:user_id] == @question.user_id %>
    <form id='choose-best-answer' method="post" action='/questions/<%= @question.id %>'>
      <input type='hidden' name='_method' value="PUT" />
      <input type='hidden' name="answer_id" value=<%= answer.id %> />
      <input type="submit" name='submit-best' value="The Best!" />
    </form>
  <% end %>
  <p>
    <div id='answer-author'> Answer Author: <%= answer.user.username %>
    </div>
  </p>

  Answer Comments:
  <% if session[:user_id] %>
    <div>
      <a href="/comments/new?commentable_type=answer&commentable_id=<%= answer.id %>">Add a comment</a>
    </div>
  <% end %>
    <% answer.comments.each do |comment| %>
      <p>
        <div id='answer-comment-text'>
          <%= comment.text %>
        </div>
      </p>
      # of upvotes: <%= comment.votes.where(upvote: 'true').count %>
      <p>
      # of downvotes: <%= comment.votes.where(upvote: 'false').count %>
    </p>

    <% if session[:user_id] != nil %>
      <form id='answer-comment-upvotes' method="post" action='/votes'>
        <input type='hidden' name='voteable_type' value='comment' />
        <input type='hidden' name='voteable_id' value=<%= comment.id %> />
        <input type='hidden' name='upvote' value='true' />
        <input type='hidden' name='question_page' value=<%= @question.id %> />
        <input type="submit" name="upvote-answer-comment" value="Upvote comment" ></button>
      </form>

      <form id='answer-comment-downvotes' method="post" action='/votes'>
        <input type='hidden' name='voteable_type' value='comment' />
        <input type='hidden' name='voteable_id' value=<%= comment.id %> />
        <input type='hidden' name='upvote' value='false' />
        <input type='hidden' name='question_page' value=<%= @question.id %> />
        <input type="submit" name="downvote-answer-comment" value="Downvote comment" ></button>
      </form>
    <% end %>


    <p>
      <div id='answer-comment-author'>
        Answer Comment Author: <%= comment.user.username %>
      </div>
    </p>
  <% end %>
<% end %>
